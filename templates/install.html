<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ÿ£ŸÑŸÅŸäÿ© - 1000 —Å–ª–æ–≤ –ö–æ—Ä–∞–Ω–∞</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
    
    <!-- üî• –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï PWA META –¢–ï–ì–ò -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#8B5FBF">
    
    <!-- Apple Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ÿ£ŸÑŸÅŸäÿ©">
    <link rel="apple-touch-icon" href="/static/icons/icon-192x192.png">
    
    <style>
        .install-container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 100px;
        }

        .install-hero {
            text-align: center;
            margin-bottom: 30px;
            padding: 40px 30px;
            background: var(--gradient-surface);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .install-icon {
            font-size: 80px;
            color: var(--primary);
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .benefits-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 30px 0;
        }

        .benefit-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px 15px;
            border-radius: var(--border-radius-small);
            text-align: center;
            transition: var(--transition);
        }

        .benefit-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .benefit-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .benefit-card:nth-child(1) .benefit-icon { color: var(--primary); }
        .benefit-card:nth-child(2) .benefit-icon { color: var(--secondary); }
        .benefit-card:nth-child(3) .benefit-icon { color: var(--accent); }
        .benefit-card:nth-child(4) .benefit-icon { color: var(--warning); }

        .benefit-text {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 600;
            line-height: 1.4;
        }

        .manual-steps {
            background: var(--surface-light);
            padding: 25px;
            border-radius: var(--border-radius);
            margin-top: 20px;
        }

        .step {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--border-radius-small);
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            flex-shrink: 0;
        }

        .step-content h4 {
            color: var(--text-primary);
            margin-bottom: 5px;
            font-size: 15px;
        }

        .step-content p {
            color: var(--text-secondary);
            font-size: 13px;
            line-height: 1.4;
            margin: 0;
        }

        .install-status {
            color: var(--text-muted);
            font-size: 14px;
            margin: 15px 0;
            text-align: center;
            min-height: 20px;
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0,-20px,0);
            }
            70% {
                transform: translate3d(0,-10px,0);
            }
            90% {
                transform: translate3d(0,-4px,0);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <!-- Arabic Letters Background -->
    <div class="arabic-bg">
        <div class="arabic-letter letter-1">ÿ£</div>
        <div class="arabic-letter letter-2">ŸÑ</div>
        <div class="arabic-letter letter-3">ŸÅ</div>
        <div class="arabic-letter letter-4">Ÿä</div>
        <div class="arabic-letter letter-5">ÿ©</div>
    </div>

    <div class="install-container">
        <!-- Header -->
        <div class="page-header">
            <a href="/app/" class="back-button">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h1>
        </div>

        <!-- Install Hero Section -->
        <div class="install-hero">
            <div class="install-icon">üì±</div>
            <h2 style="font-size: 28px; margin-bottom: 15px; color: var(--text-primary);">
                ÿ£ŸÑŸÅŸäÿ© –≤ –≤–∞—à–µ–º –∫–∞—Ä–º–∞–Ω–µ
            </h2>
            <p style="color: var(--text-secondary); font-size: 16px; line-height: 1.6; margin-bottom: 30px;">
                –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–∑—É—á–µ–Ω–∏—é –∞—Ä–∞–±—Å–∫–∏—Ö —Å–ª–æ–≤. 
                –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ —ç–∫–æ–Ω–æ–º–∏—Ç –∑–∞—Ä—è–¥ –±–∞—Ç–∞—Ä–µ–∏.
            </p>
            
            <!-- Install Button -->
            <button id="installButton" class="btn-primary large pulse" style="margin-bottom: 15px; display: none;">
                <i class="fas fa-download"></i>
                –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            </button>
            
            <div id="installStatus" class="install-status">
                –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏...
            </div>
            
            <p style="color: var(--text-muted); font-size: 14px;">
                –ë–µ—Å–ø–ª–∞—Ç–Ω–æ ‚Ä¢ 5 –ú–ë ‚Ä¢ –î–ª—è iOS –∏ Android
            </p>
        </div>

        <!-- Benefits -->
        <div class="card">
            <h3 style="color: var(--text-primary); margin-bottom: 20px; text-align: center;">
                –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
            </h3>
            
            <div class="benefits-grid">
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="benefit-text">–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫</div>
                </div>

                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-wifi-slash"></i>
                    </div>
                    <div class="benefit-text">–†–∞–±–æ—Ç–∞ –æ—Ñ–ª–∞–π–Ω</div>
                </div>

                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    <div class="benefit-text">–£–º–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</div>
                </div>

                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-battery-three-quarters"></i>
                    </div>
                    <div class="benefit-text">–≠–∫–æ–Ω–æ–º–∏—è –±–∞—Ç–∞—Ä–µ–∏</div>
                </div>
            </div>
        </div>

        <!-- Manual Install Instructions -->
        <div id="manualInstall" class="manual-steps" style="display: none;">
            <h3 style="color: var(--text-primary); margin-bottom: 20px; text-align: center;">
                –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏
            </h3>
            
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>–î–ª—è Android / Chrome</h4>
                    <p>–û—Ç–∫—Ä–æ–π—Ç–µ –º–µ–Ω—é –±—Ä–∞—É–∑–µ—Ä–∞ (—Ç—Ä–∏ —Ç–æ—á–∫–∏) ‚Üí "–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω" ‚Üí "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"</p>
                </div>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>–î–ª—è iPhone / Safari</h4>
                    <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" (üì§) ‚Üí "–ù–∞ —ç–∫—Ä–∞–Ω ¬´–î–æ–º–æ–π¬ª" ‚Üí "–î–æ–±–∞–≤–∏—Ç—å"</p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <a href="/app/" class="btn-secondary" style="width: 100%;">
                    <i class="fas fa-play"></i>
                    –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
                </a>
            </div>
        </div>

        <!-- Already Installed -->
        <div id="alreadyInstalled" class="card" style="display: none; text-align: center; padding: 40px 30px;">
            <div style="color: var(--success); font-size: 64px; margin-bottom: 20px;">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3 style="color: var(--text-primary); margin-bottom: 10px; font-size: 24px;">
                –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!
            </h3>
            <p style="color: var(--text-secondary); margin-bottom: 30px; font-size: 16px;">
                ÿ£ŸÑŸÅŸäÿ© —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ.
            </p>
            <a href="/app/" class="btn-primary large">
                <i class="fas fa-play"></i>
                –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            </a>
        </div>

        <!-- Support Info -->
        <div class="card" style="text-align: center; margin-top: 30px; background: rgba(139, 95, 191, 0.1);">
            <h4 style="color: var(--text-primary); margin-bottom: 10px;">–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?</h4>
            <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 15px;">
                –ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
            </p>
            <a href="https://t.me/your_support_bot" style="color: var(--primary); text-decoration: none; font-weight: 600;">
                <i class="fab fa-telegram"></i> Telegram –ø–æ–¥–¥–µ—Ä–∂–∫–∞
            </a>
        </div>
    </div>

    <script>
        class PWAInstaller {
            constructor() {
                this.deferredPrompt = null;
                this.installButton = document.getElementById('installButton');
                this.installStatus = document.getElementById('installStatus');
                this.alreadyInstalled = document.getElementById('alreadyInstalled');
                this.manualInstall = document.getElementById('manualInstall');

                this.init();
            }

            init() {
                console.log('üöÄ PWA Installer initialized');

                // Check if already installed
                if (this.isAppInstalled()) {
                    this.showAlreadyInstalled();
                    return;
                }

                this.setupEventListeners();
                this.setupServiceWorker();

                // Show manual instructions if no prompt after 3 seconds
                setTimeout(() => {
                    if (!this.deferredPrompt) {
                        this.showManualInstructions();
                    }
                }, 3000);
            }

            isAppInstalled() {
                return window.matchMedia('(display-mode: standalone)').matches ||
                       window.navigator.standalone === true;
            }

            setupEventListeners() {
                // BeforeInstallPrompt event
                window.addEventListener('beforeinstallprompt', (e) => {
                    console.log('üéâ PWA install prompt available');
                    e.preventDefault();
                    this.deferredPrompt = e;

                    this.showInstallReady();
                });

                // Install button click
                this.installButton.addEventListener('click', () => {
                    this.installApp();
                });

                // App installed event
                window.addEventListener('appinstalled', (evt) => {
                    console.log('üéä PWA app installed successfully');
                    this.showAlreadyInstalled();
                });
            }

            showInstallReady() {
                this.installButton.style.display = 'flex';
                this.installStatus.textContent = '–ì–æ—Ç–æ–≤–æ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ! –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ.';
                this.installStatus.style.color = 'var(--success)';
            }

            showManualInstructions() {
                this.installStatus.textContent = '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –Ω–∏–∂–µ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏';
                this.installStatus.style.color = 'var(--warning)';
                this.manualInstall.style.display = 'block';
            }

            showAlreadyInstalled() {
                this.installButton.style.display = 'none';
                this.manualInstall.style.display = 'none';
                this.alreadyInstalled.style.display = 'block';
                this.installStatus.textContent = '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ';
                this.installStatus.style.color = 'var(--success)';
            }

            async installApp() {
                console.log('üîÑ Starting PWA installation...');

                if (this.deferredPrompt) {
                    try {
                        // Show native install prompt
                        this.installButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –£—Å—Ç–∞–Ω–æ–≤–∫–∞...';
                        this.installButton.disabled = true;

                        this.deferredPrompt.prompt();

                        const { outcome } = await this.deferredPrompt.userChoice;

                        if (outcome === 'accepted') {
                            console.log('‚úÖ User accepted PWA installation');
                            this.installStatus.textContent = '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å...';
                        } else {
                            console.log('‚ùå User dismissed PWA installation');
                            this.installStatus.textContent = '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –Ω–∏–∂–µ.';
                            this.showManualInstructions();
                            this.resetInstallButton();
                        }

                        this.deferredPrompt = null;

                    } catch (error) {
                        console.error('üí• Installation error:', error);
                        this.installStatus.textContent = '–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –Ω–∏–∂–µ.';
                        this.showManualInstructions();
                        this.resetInstallButton();
                    }
                } else {
                    // PWA not supported
                    console.log('‚ÑπÔ∏è PWA install not supported');
                    this.showManualInstructions();
                }
            }

            resetInstallButton() {
                this.installButton.innerHTML = '<i class="fas fa-download"></i> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ';
                this.installButton.disabled = false;
            }

            async setupServiceWorker() {
                if ('serviceWorker' in navigator) {
                    try {
                        // üî• –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ü–£–¢–¨ - /sw.js
                        const registration = await navigator.serviceWorker.register('/sw.js');
                        console.log('üîß ServiceWorker registered:', registration.scope);
                    } catch (error) {
                        console.log('‚ùå ServiceWorker registration failed:', error);
                    }
                }
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new PWAInstaller();
        });

        // Periodic check for installation status
        setInterval(() => {
            const installer = window.pwaInstaller;
            if (installer && installer.isAppInstalled() &&
                installer.alreadyInstalled.style.display === 'none') {
                installer.showAlreadyInstalled();
            }
        }, 2000);
    </script>
</body>
</html>
